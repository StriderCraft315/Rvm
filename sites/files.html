<!DOCTYPE html>
<html>
<head>
    <title>File Manager - Rvm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --bg: #1a1a1a; --card: #2d2d2d; --text: white; --primary: #007bff; --danger: #dc3545; }
        body { font-family: Arial; margin: 0; padding: 20px; background: var(--bg); color: var(--text); }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav { margin-bottom: 20px; }
        .nav a { color: var(--primary); text-decoration: none; margin-right: 15px; }
        .card { background: var(--card); padding: 20px; border-radius: 10px; border: 1px solid #444; margin-bottom: 20px; }
        .file-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #444; align-items: center; }
        .file-item:hover { background: #3d3d3d; }
        button { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; margin: 0 2px; }
        button.danger { background: var(--danger); }
        input { padding: 8px; background: #1a1a1a; border: 1px solid #444; color: white; border-radius: 3px; margin: 5px; }
        .path-bar { background: var(--card); padding: 10px; border-radius: 5px; margin-bottom: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>File Manager</h1>
            <div>Welcome, <strong>{{ username }}</strong> | <a href="/" style="color: var(--primary);">Dashboard</a></div>
        </div>

        <div class="nav">
            <a href="/">‚Üê Back to Dashboard</a>
        </div>

        <div class="card">
            <h3>Current Directory</h3>
            <div class="path-bar">{{ current_path }}</div>
            
            <div style="margin-bottom: 15px;">
                <input type="text" id="new-folder" placeholder="New folder name">
                <button onclick="createFolder()">Create Folder</button>
            </div>

            <div style="margin-bottom: 15px;">
                <input type="file" id="file-upload">
                <button onclick="uploadFile()">Upload File</button>
            </div>

            <div>
                {% if current_path != "/" %}
                <div class="file-item">
                    <div>üìÅ ..</div>
                    <div></div>
                    <div>
                        <button onclick="navigateTo('{{ parent_path }}')">Open</button>
                    </div>
                </div>
                {% endif %}

                {% for file in files %}
                <div class="file-item">
                    <div>
                        {% if file.is_dir %}üìÅ{% else %}üìÑ{% endif %}
                        {{ file.name }}
                        {% if not file.is_dir %}<small>({{ (file.size / 1024) | round(2) }} KB)</small>{% endif %}
                    </div>
                    <div>
                        <small>{{ file.modified }}</small>
                    </div>
                    <div>
                        {% if file.is_dir %}
                        <button onclick="navigateTo('{{ file.path }}')">Open</button>
                        {% else %}
                        <button onclick="downloadFile('{{ file.path }}')">Download</button>
                        {% endif %}
                        <button onclick="deleteItem('{{ file.path }}')" class="danger">Delete</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        async function navigateTo(path) {
            window.location.href = '/files?path=' + encodeURIComponent(path);
        }

        async function createFolder() {
            const name = document.getElementById('new-folder').value;
            if (name) {
                const formData = new FormData();
                formData.append('name', name);
                formData.append('path', '{{ current_path }}');
                
                await fetch('/api/files/create-folder', {
                    method: 'POST',
                    body: formData
                });
                document.getElementById('new-folder').value = '';
                location.reload();
            }
        }

        async function uploadFile() {
            const fileInput = document.getElementById('file-upload');
            const file = fileInput.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('path', '{{ current_path }}');
                
                await fetch('/api/files/upload', {
                    method: 'POST',
                    body: formData
                });
                fileInput.value = '';
                location.reload();
            }
        }

        function downloadFile(path) {
            window.open('/api/files/download?path=' + encodeURIComponent(path), '_blank');
        }

        async function deleteItem(path) {
            if (confirm('Are you sure you want to delete this?')) {
                const formData = new FormData();
                formData.append('path', path);
                
                await fetch('/api/files/delete', {
                    method: 'POST',
                    body: formData
                });
                location.reload();
            }
        }
    </script>
</body>
</html>
